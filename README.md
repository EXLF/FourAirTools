# FourAir社区撸毛工具箱 (Electron 桌面版)

这是一个专为Web3用户设计的空投任务管理和批量交互工具，以 Electron 桌面应用的形式提供，旨在帮助用户在本地安全、高效地参与各种空投活动和链上交互。

## 功能特点 (开发中)

*   **仪表盘**: 概览核心数据、主要网络 Gas 等 (开发中)。
*   **钱包管理 (功能已完善)**:
    *   使用本地 SQLite 数据库统一管理钱包（地址、私钥、助记词、备注、分组）。
    *   **数据加密**: 钱包的私钥和助记词在存入数据库前，会使用基于用户主密码派生的密钥进行 AES-GCM 加密存储。
    *   **按需解密**: 点击"查看详情"或执行导出操作时，应用会安全地解密并显示/使用私钥/助记词。
    *   **基础操作**: 支持添加、编辑（仅备注和分组）、删除钱包。
    *   **分组管理**: 支持创建、重命名、删除钱包分组。
    *   **批量操作**: 支持批量生成钱包、批量删除钱包（带确认提示）。
    *   **导入/导出**: 支持从 JSON 文件导入钱包数据（导入时自动加密）；支持将选中钱包导出为 JSON 文件（提供明文导出的安全确认）。
    *   **查看详情**: 可在模态框中查看钱包的完整地址、解密后的私钥和助记词（如果已存储），并提供复制按钮。
    *   **余额查询**: 表格中显示钱包的 ETH 余额（通过 JSON-RPC 查询，带缓存机制）。
    *   **钱包-社交账户关联 (功能完成)**: 
        *   支持将钱包与已添加的社交账户（如 Twitter, Discord, Email 等）进行关联。
        *   钱包列表新增"关联账户"列，用平台图标和数量徽章简洁展示关联状态。
        *   点击该列可直接打开管理模态框，提供标签页（所有、已关联）、搜索和分页（针对"所有"和"已关联"）功能，方便高效地管理钱包与社交账户的关联关系。
    *   **界面交互**:
        *   实现表格筛选（按分组）、搜索（地址/名称/备注/分组）、分页（可自定义每页条数）、行内点击选中、统一 Toast 提示等交互优化。
        *   **加密数据显示**: 表格中加密的私钥和助记词会以缩短形式显示。
        *   优化模态框样式（如钱包编辑、分组管理），统一输入框风格。
*   **社交账户管理 (基础功能已实现)**:
    *   使用本地 SQLite 数据库管理社交账户（平台、用户名、绑定邮箱/手机、备注、分组）。
    *   **基础操作**: 支持添加、编辑、删除社交账户。
    *   **界面交互**: 实现平台按钮筛选、分页（可自定义每页条数）、表头全选、行内点击选中、添加时自动选择默认分组。
        *   优化添加/编辑模态框的样式，修复分组选择布局问题。
    *   *(待实现)* 导入/导出、批量操作。
*   **项目跟踪**: 卡片式展示和管理空投项目 (开发中)。
*   **脚本插件**: 执行批量或自动化操作 (开发中)。
*   **IP代理管理 (基础功能已实现)**:
    *   使用本地 SQLite 数据库管理代理配置（支持 HTTP、HTTPS、SOCKS5）。
    *   **基础操作**: 支持添加、编辑、删除、测试代理。
    *   **安全存储**: 代理密码使用与钱包相同的加密机制进行加密存储。
    *   **代理测试**: 支持测试代理连通性，获取出口 IP 信息和风险评分。
    *   **全局应用**: 支持将代理应用到 Electron 应用全局。
    *   **界面交互**: 实现类型筛选、分组管理、分页、搜索等功能。
*   **教程中心**: 提供Web3知识和教程 (开发中)。
*   **社区交流**: 提供社区入口 (开发中)。
*   **软件设置**: 配置应用参数 (开发中)。
*   **安全机制 (核心已实现)**:
    *   **主密码**: 应用首次启动时引导用户设置主密码。
    *   **密码验证与配置**: 加密验证字符串、盐值、迭代次数存储在 `encryption.config.json`。
    *   **加密核心**: 使用 PBKDF2 和 AES-GCM 对敏感数据进行加密。
    *   **应用解锁**: 启动时要求输入主密码以加载会话密钥（除非使用自动解锁）。
    *   **自动解锁**: 可选，通过操作系统凭据管理器（`keytar`）安全存储主密钥，实现自动登录。
    *   **手动锁定**: 提供接口 (`app:lock`) 清除内存和系统中的密钥，强制下次需要密码。(UI 按钮待添加)

## 技术栈

*   **框架**: Electron
*   **前端**: HTML5, CSS3, JavaScript (ES Modules)
*   **本地数据库**: SQLite (通过 `sqlite3` Node.js 模块)
*   **核心库**:
    *   Font Awesome (图标)
    *   `keytar` (操作系统凭据管理器访问)
    *   `ethers.js` (用于查询钱包余额)

## 项目结构

```
.                                   # 项目根目录
├── .gitignore                      # Git 忽略文件配置
├── README.md                       # 项目说明文档
├── database.db                     # SQLite 数据库文件（本地自动生成）
├── index.html                      # 主 HTML 骨架文件
├── main.js                         # Electron 主进程入口
├── package-lock.json               # npm 依赖锁定文件
├── package.json                    # 项目依赖与配置
├── src/                            # 源码目录
│   ├── css/                        # 样式文件目录
│   │   ├── main.css                # 主样式入口
│   │   ├── base/                   # 基础布局/重置/响应式样式
│   │   ├── components/             # 组件级样式（表单、模态框、按钮等）
│   │   └── pages/                  # 各页面专属样式
│   ├── js/                         # 前端 JS 逻辑
│   │   ├── core/                   # 应用核心逻辑（导航、入口、加密、认证等）
│   │   ├── components/             # 可复用UI组件逻辑
│   │   ├── db/                     # 数据库访问与CRUD（主进程用）
│   │   ├── pages/                  # 各页面业务逻辑
│   │   │   ├── dashboard/          # 仪表盘页面模块
│   │   │   │   ├── index.js        # 仪表盘页面入口
│   │   │   │   ├── actions.js      # (可选) 仪表盘操作逻辑
│   │   │   │   ├── modals.js       # (可选) 仪表盘模态框逻辑
│   │   │   │   └── table.js        # (可选) 仪表盘表格/列表逻辑
│   │   │   ├── wallets/            # 钱包管理页面模块
│   │   │   │   ├── index.js        # 钱包页面入口
│   │   │   │   ├── actions.js      # 钱包页面操作逻辑 (导入/导出/批量删除等)
│   │   │   │   ├── modals.js       # 钱包页面模态框逻辑 (编辑/分组/生成等)
│   │   │   │   └── table.js        # 钱包表格渲染/分页/筛选逻辑
│   │   │   ├── social/             # 社交账户页面模块
│   │   │   │   ├── index.js        # 社交页面入口
│   │   │   │   ├── actions.js      # 社交页面操作逻辑 (编辑/删除/批量)
│   │   │   │   ├── modals.js       # 社交页面模态框逻辑 (添加/编辑)
│   │   │   │   └── table.js        # 社交表格渲染/分页/筛选逻辑
│   │   │   ├── network/            # 网络工具页面模块 (结构同上)
│   │   │   ├── settings/           # 设置页面模块 (结构同上)
│   │   │   ├── tutorials/          # 教程页面模块 (结构同上)
│   │   │   ├── projects/           # 项目跟踪页面模块 (结构同上)
│   │   │   └── scriptPlugins/      # 脚本插件页面模块 (结构同上)
│   │   └── utils/                  # 通用工具函数
│   ├── main/                       # 主进程相关代码
│   │   └── ipcHandlers/            # 主进程IPC处理器
│   ├── templates/                  # HTML页面模板片段
│   └── preload.js                  # Electron Preload 脚本
```

## 模块化页面结构

`src/js/pages/` 目录下的每个页面逻辑被拆分为独立的模块 (`index.js`, `actions.js`, `modals.js`, `table.js`)，以提高代码的可读性和可维护性。

## 如何运行 (开发模式)

1.  确保安装了 Node.js (自带 npm)。
2.  克隆或下载本仓库。
3.  进入项目根目录，运行 `npm install` 安装依赖。
4.  运行 `npm start` 或 `npm run dev` 启动应用。

## 注意事项

*   **安全提示**:
    *   请务必 **牢记并妥善保管您设置的主密码**。丢失主密码可能导致加密数据永久丢失。
    *   确保您的操作系统账户安全，特别是在启用自动解锁功能时。
*   目前主要完成了钱包管理的核心功能和安全机制，以及社交账户管理的基础功能。其他模块仍在开发中。

## 后续开发计划

*   [ ] **社交账户管理**: 实现导入/导出、批量操作。
*   [ ] 完善其他模块 (项目跟踪、脚本插件等) 的 UI 和数据存储。
*   [x] 完善钱包管理模块功能（分组、导入/导出、批量操作、查看详情、UI 交互优化）。
*   [x] **社交账户管理**: 实现分组筛选、搜索功能，优化添加/编辑模态框样式及布局。
*   [x] 修复分组管理和社交账户模态框的样式问题。
*   [x] **实现安全的私钥/助记词加密存储机制 (AES-GCM + 主密码)。**
*   [x] **实现应用启动时的解锁流程 (手动密码验证 + Keytar 自动解锁)。**
*   [x] **实现数据显示/使用时的解密逻辑。**
*   [ ] **考虑加密导出/导入功能。** (注：当前导出有明文选项，导入自动加密)
*   [ ] **添加手动锁定按钮到 UI。**
*   [ ] **添加修改主密码的功能。**
*   [x] 集成钱包连接库 (如 Web3Modal) 或实现基础的链上数据查询 (余额, Tx数)。 (注：已实现余额查询)
*   [ ] 优化 UI 和用户体验 (持续进行)。
*   [ ] 增加单元测试和集成测试。
*   [ ] 配置 `electron-builder` 实现应用打包。

## 贡献

欢迎通过 Issue 或 Pull Request 提供建议和改进。

## 免责声明

本工具仅供学习和研究使用，用户应自行承担使用过程中的风险。开发者不对因使用本工具导致的任何损失负责。

## 近期重要更新

*   **IP代理管理模块**: 实现了代理配置的增删改查、连通性测试、出口IP检测等功能，支持 HTTP/HTTPS/SOCKS5 代理，并可应用到应用全局。
*   **数据库模块结构重构**: 按功能拆分到 `src/js/db/` 下的 `group.js`, `wallet.js`, `social.js`, `proxy.js`。
*   **主进程数据库调用方式变更**: 统一为 `db.module.method(db.db, ...)`。
*   **批量生成钱包功能修复**: 正确保存数据，过滤无效钱包。
*   **Preload 脚本位置调整**: 移动到 `src/` 目录。
*   **钱包余额查询**: 添加了余额显示和缓存。
*   **安全增强**: 实现了完整的加密存储和解锁流程（含 Keytar 自动解锁）。
*   **导入/导出**: 实现了带加密/解密的钱包导入导出功能。
*   **钱包核心功能完善**: 基本完成了钱包管理的增查、导入导出、余额显示等核心功能。
*   **社交账户基础功能**: 实现了增删改查、平台筛选、分页等。
*   **钱包-社交账户关联**: 完成了钱包与社交账户的关联功能，包括在钱包列表中展示关联状态（图标+数量徽章），以及提供交互友好的模态框（含标签页、搜索、分页）用于管理关联关系。
*   **教程中心WebView优化**: 完善了教程中心WebView的链接处理机制，使用预加载脚本拦截链接点击并在系统浏览器中打开，解决了多窗口打开和资源清理问题，提升了用户体验。

## 教程中心

教程中心模块旨在为用户提供与Web3相关的知识和特定项目教程。

*   **内置教程列表**: 支持从本地 `src/data/tutorials.json` 或远程服务器API加载教程数据，按分类展示。
*   **远程API服务器**: 
    *   部署了Express服务器提供教程数据API
    *   支持添加、编辑、删除和查询教程数据
    *   通过RESTful API实现教程数据的CRUD操作
    *   支持按分类筛选、分页查询和搜索功能
*   **嵌入式内容浏览**: 利用 Electron 的 `<webview>` 标签在应用内直接展示教程内容（例如 Notion 页面）。
    *   解决了直接嵌入 Notion 等网站时可能出现的安全限制和内容显示问题。
    *   通过注入自定义 CSS 优化了嵌入页面的显示效果，确保内容能正常填充可用区域。
    *   **外部链接处理**: 实现了智能链接处理机制，使webview内点击的外部链接能自动在系统默认浏览器中打开。
    *   **预加载脚本**: 使用Electron的预加载脚本机制，在webview内部注入事件拦截代码，确保点击链接时的正确行为。
    *   **防重复处理**: 实现了防重复处理机制，避免同一链接短时间内被重复打开。
    *   **资源清理**: 优化了webview的创建和销毁流程，防止使用过程中出现资源泄漏和标签页累积问题。
*   **交互体验**: 支持分类切换、点击教程项在 WebView 中打开、关闭和刷新 WebView。

## 服务器部署

项目包含一个Express服务器，用于提供教程数据API和其他后端功能。

*   **服务器目录**: `server/` 包含Express服务器代码
*   **API端点**:
    *   `GET /api/tutorials`: 获取教程列表，支持分页和搜索
    *   `POST /api/tutorials`: 创建新教程
    *   `PUT /api/tutorials/:id`: 更新现有教程
    *   `DELETE /api/tutorials/:id`: 删除教程
*   **部署步骤**:
    *   服务器代码已部署到远程服务器
    *   使用PM2进行进程管理，确保服务持久运行
    *   配置防火墙开放必要端口
    *   客户端通过服务器IP+端口访问API服务