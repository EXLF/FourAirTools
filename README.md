# FourAir社区撸毛工具箱 (Electron 桌面版)

这是一个专为Web3用户设计的空投任务管理和批量交互工具，以 Electron 桌面应用的形式提供，旨在帮助用户在本地安全、高效地参与各种空投活动和链上交互。

## 主要功能

*   **仪表盘**: 概览核心数据、主要网络 Gas 费等。
*   **钱包管理**:
    *   安全管理钱包（地址、私钥、助记词、备注、分组），支持批量生成、导入/导出 (JSON) 和精细化分组。
    *   敏感信息（私钥、助记词）通过主密码加密存储在本地数据库，字段名明确为 `encryptedPrivateKey` 和 `encryptedMnemonic`。
    *   支持查看钱包详情（含按需解密后的敏感数据）和主要代币余额查询。
    *   可将钱包与社交账户进行关联管理。
*   **社交账户管理**:
    *   统一管理多平台社交账户（Twitter, Discord, Telegram, Email 等），包括账户凭证和分组。
    *   支持根据平台动态显示和编辑特定信息（如Twitter 2FA, Discord Token）。
    *   表格中可按平台筛选并安全显示（解密后）相关账户信息。
*   **IP代理管理**:
    *   管理HTTP/HTTPS/SOCKS5代理配置，支持批量测试、导入/导出。
    *   代理密码在存储前会进行加密，并在需要时（如脚本执行）由应用后端按需解密。
    *   提供代理连通性、延迟、出口IP信息及风险评估。
    *   支持在添加代理时批量导入多个代理配置，支持多种格式，包括"IP:端口:账号:密码"和"协议类型:IP:端口:账号:密码"等格式。
*   **脚本插件**:
    *   支持加载和执行用户自定义脚本，实现批量或自动化链上交互。
    *   脚本引擎在执行脚本时，会按需解密选定钱包的私钥/助记词以及选定代理的密码，安全地提供给沙箱中的脚本使用。
    *   脚本沙箱环境进一步加固，限制了对宿主 `process.env` 的直接访问。
    *   提供脚本执行配置界面（如关联钱包、代理选择）和实时日志监控。
    *   内置脚本格式标准和通用工具库（HTTP, Web3, Logger, 验证码处理等）。
*   **常用工具**:
    *   聚合常用Web3工具和资源链接（如交易所、钱包插件、数据分析、跨链桥、区块浏览器、安全工具），点击可在外部浏览器中安全打开。
*   **社区交流**:
    *   应用内嵌入Discord社区，支持会话保持和账户管理。
*   **软件设置**:
    *   提供应用级参数配置。
*   **通用交互**:
    *   大部分模块提供统一的数据表格交互，包括搜索、筛选、分页功能。
    *   通过 Toast 提供操作反馈，模态框用于复杂交互和信息展示。

## 安全机制

*   **主密码**: 首次启动强制设置主密码，用于加密本地敏感数据。后续启动需通过持久化模态框输入主密码解锁。
*   **数据加密**: 钱包私钥、助记词 (存储为 `encryptedPrivateKey` 和 `encryptedMnemonic`)、代理密码及社交账户凭证等敏感信息，使用基于主密码派生的密钥通过 AES-GCM 加密后存储在本地 SQLite 数据库。数据库层面包含迁移逻辑，以确保旧数据中的明文密码能被加密。
*   **按需解密**: 加密的敏感数据（如钱包密钥、代理密码）仅在必要时（如脚本执行、用户查看详情）在主进程中解密，并以安全的方式传递给渲染进程或脚本沙箱。
*   **脚本沙箱安全**: 用户脚本在受限的 `vm2` 沙箱环境中执行，移除了对 `process.env` 的直接暴露，脚本引擎负责安全地提供必要的上下文信息（包括解密后的密钥和代理凭证）。
*   **持久化模态框**: 核心认证流程（初始密码设置、应用解锁）采用持久化模态框 (`src/js/components/modal.js`)，确保用户完成关键安全步骤。
*   **自动解锁 (可选)**: 支持通过操作系统凭据管理器 (`keytar`) 安全存储主密钥，实现应用的自动解锁。
*   **手动锁定**: 提供应用锁定功能，清除内存和系统中的密钥，下次使用需重新输入主密码。

## 技术栈

*   **框架**: Electron
*   **前端**: HTML5, CSS3, JavaScript (ES Modules)
    *   **UI 组件**: 包括一个可配置的模态框组件 (`src/js/components/modal.js`)，支持常规关闭和持久化显示模式。
*   **本地数据库**: SQLite (通过 `sqlite3` Node.js 模块)
*   **核心库**: Font Awesome, `keytar`, `ethers.js`

## 项目结构概览

项目主要源码位于 `src/` 目录下，分为：
*   `src/main/`: Electron 主进程相关代码，包括应用生命周期管理、核心服务 (加密、钱包生成)、数据库接口、IPC通讯处理和脚本引擎。
*   `src/js/`: 渲染进程相关代码 (前端逻辑)，包括核心应用逻辑 (入口、认证、导航)、UI组件、各功能页面的业务逻辑和工具函数。
*   `src/css/`: 应用的样式文件。
*   `src/assets/`: 图标等静态资源。
*   `index.html`: 应用的主HTML骨架。
*   `preload.js`: Electron预加载脚本。

更详细的目录结构请参考 `project_structure.md` 文件。

## 如何运行 (开发模式)

1.  确保已安装 Node.js (自带 npm)。
2.  克隆或下载本仓库。
3.  在项目根目录下运行 `npm install` 安装依赖。
4.  运行 `npm start` 或 `npm run dev` 启动应用。

## 注意事项

*   **安全第一**: 请务必牢记并妥善保管您设置的主密码。丢失主密码将导致加密数据无法恢复。启用自动解锁功能时，请确保您的操作系统账户安全。
*   **开发状态**: 本项目仍在持续开发中，部分功能可能尚未完善。

## 模块重构: 社交账户 (Social)

当前正在对 `src/js/pages/social/` 目录及其相关模板 `src/templates/social.html` 进行重构。

**重构目标:**

1.  **提升模块化与代码组织**: 重点关注 `table.js` (原先超过600行)，将其中的渲染逻辑逐步迁移到新的 `socialTableRenderer.js` 文件中。
2.  **增强代码清晰度和可维护性**: 使 `table.js` 更侧重于业务逻辑、数据获取和事件处理，而 `socialTableRenderer.js` 专注于DOM元素的生成和更新。
3.  **遵循关注点分离原则**: 明确渲染逻辑和业务逻辑的界限。
4.  **修复潜在错误**: 在重构过程中解决发现的bug，例如模板字符串的语法错误。

**已完成的主要重构内容概要 (进行中):**

*   **创建 `src/js/pages/social/socialTableRenderer.js`**:
    *   用于存放从 `table.js` 中分离出来的渲染相关函数。
*   **功能迁移至 `socialTableRenderer.js`**:
    *   `renderTableHeader`: 负责根据平台配置动态生成表格头部HTML。
    *   `createSocialAccountRowElement`: 负责根据账户数据和列配置生成表格行DOM元素。
        *   其内部辅助函数 `getDisplayValue` (用于格式化单元格内容) 和 `escapeAttribute` (用于安全处理属性值) 也一并迁移。
*   **`src/js/pages/social/table.js` 更新**:
    *   移除了上述已迁移函数的本地定义。
    *   更新了导入语句，从 `socialTableRenderer.js` 导入这些渲染函数。
    *   相应地更新了函数调用，传递必要的参数 (例如，`createSocialAccountRowElement` 现在接收 `SENSITIVE_FIELDS_FOR_COPY` 和 `handleSocialAccountAction` 回调)。
*   **问题修复**:
    *   解决了在迁移 `createSocialAccountRowElement` 到 `socialTableRenderer.js` 时，由于模板字符串中反引号处理不当导致的 `SyntaxError: Invalid or unexpected token` 错误。
*   **HTML模板 (`src/templates/social.html`)**:
    *   为"批量导入"按钮添加了 `id="bulk-import-social-btn"`。
    *   为"导出选中"按钮添加了 `id="export-selected-social-btn"`。

**后续计划**:
*   继续将 `table.js` 中的其他渲染相关逻辑 (如 `createPageSizeSelector` 和 `renderPagination`) 迁移到 `socialTableRenderer.js`。

## 近期关键增强

*   **脚本插件系统**:
    *   实现了模块化脚本架构，支持用户自定义脚本的加载、配置和执行。
    *   完善了脚本执行引擎，支持代理配置和实时日志输出。
    *   优化了脚本执行相关的钱包选择和UI交互。
*   **安全性与认证**:
    *   增强了模态框组件，支持持久化模式，并应用于初始密码设置和应用解锁流程。
    *   修复了Electron应用打包后数据库路径问题。
*   **核心模块功能**:
    *   **社交账户管理**: 重构数据结构以支持平台特定信息，优化了添加/编辑流程和表格显示。
    *   **教程中心**: 实现教程数据的API加载和应用内`<webview>`嵌入式浏览，优化了外部链接处理。
    *   **社区交流**: 优化了Discord嵌入的会话管理和UI交互。
    *   **IP代理**: 
        *   新增批量导入功能，支持多种格式的代理配置，包括"IP:端口:账号:密码"和"协议类型:IP:端口:账号:密码"等。
        *   优化了代理测试流程和UI交互体验。
        *   修复了代理测试和应用中的若干问题。

## 自动更新 (热更新)

*   **无缝升级**: 应用集成了自动更新功能，当有新版本发布到官方 GitHub Releases 时，能够自动检测、下载并在用户同意后安装更新。
*   **用户体验**: 
    *   在应用启动时自动检查更新。
    *   通过侧边栏底部的状态区域向用户反馈更新状态（如：正在检查、发现新版本、下载中、下载完成等待安装）。
    *   提供操作按钮供用户选择何时下载和安装更新。
*   **技术实现**: 使用 `electron-updater` 库，配合 `electron-builder` 的发布流程，从指定的 GitHub 仓库 (`EXLF/uploadPackage`) 拉取更新。
*   **配置与日志**: 更新相关的配置主要在 `package.json` (发布源) 和 `src/main/index.js` (更新逻辑) 中，更新过程的详细日志通过 `electron-log` 记录。

## 贡献

欢迎通过 Issue 或 Pull Request 提供宝贵建议和代码贡献。

## 免责声明

本工具仅供学习和研究使用，用户需自行承担使用过程中的所有风险。开发者不对因使用本工具导致的任何直接或间接损失负责。

## 用户脚本

FourAir支持自定义脚本，用于自动化与各种Web3项目的交互。目前支持以下项目的脚本：

1. **Web3登录** - 自动化登录支持Web3钱包登录的网站
2. **代币批量转账** - 批量转账ERC20代币到目标地址
3. **Pharos Network** - 自动化与Pharos Network项目交互
4. **MapleStory Universe NXPC** - 自动化与MapleStory Universe NXPC项目交互 
5. **SOON** - 自动化与SOON协议交互
6. **Nockchain** - 自动化与Nockchain项目交互
7. **Energy Labs** - 自动化与Energy Labs项目交互
8. **Lighter** - 自动化与Lighter项目交互
9. **LAUNCHCOIN PASTERNAK** - 自动化与LAUNCHCOIN PASTERNAK平台交互
10. **Aster** - 自动化与Aster项目交互
11. **Camp Network** - 自动化与Camp Network项目交互
12. **Sui SUI** - 自动化与Sui链和生态系统交互

### 如何使用脚本

1. 在FourAir界面中导航到"脚本"页面
2. 选择要使用的脚本
3. 配置必要的参数
4. 点击"运行"按钮执行脚本

### 自定义脚本开发

您可以通过在`user_scripts/scripts/`目录下创建新的JS文件来添加自定义脚本。每个脚本文件需要导出两个函数：

- `getConfig()`: 返回脚本的配置信息，包括名称、描述、参数等
- `main(context)`: 脚本的主执行函数，接收context对象，包含钱包、配置等信息

### 主要特点:

*   **脚本插件**: 
    * 自动化执行各种任务脚本
    * 支持多钱包并行执行
    * 日志记录和错误处理
*   **钱包管理**: 

## 版本更新 v1.1.1

本次更新主要内容：

1. 性能优化
   - 页面级延迟加载：优化了导航系统，添加了动态导入、页面缓存和预加载机制
   - 优化了资源加载顺序，提高应用启动速度
   - 仪表盘页面优化：使用异步加载数据，避免阻塞UI渲染
   - 主进程优化：加快窗口显示速度
   - 补充了服务器优化，提高网络请求效率

2. 用户体验改进
   - 添加了加载指示器，提升用户体验
   - 优化了请求超时处理
   - 数据加载失败时的友好提示
   - 修复了之前打包中发现的问题

3. 其他改进
   - 修复了更新检查功能
   - 改进了错误处理
   - 代码结构优化
   - 排除了不必要的服务器文件，减小了安装包体积

## 打包说明

1. 已排除以下文件
   - 开发文件 (.git, .github, .vscode)
   - 构建目录 (dist, dist_electron, release-builds)
   - 开发配置文件 (.cursorignore, tsconfig.json)
   - 源码映射文件 (*.map)
   - 测试脚本 (test_*.js)
   - 文档文件 (README.md, project_structure.md)

2. 安装包路径
   - Windows: `dist_electron/FourAir-Setup-1.1.1.exe` 