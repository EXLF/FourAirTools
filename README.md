# FourAir社区撸毛工具箱 (Electron 桌面版)

这是一个专为Web3用户设计的空投任务管理和批量交互工具，以 Electron 桌面应用的形式提供，旨在帮助用户在本地安全、高效地参与各种空投活动和链上交互。

## 功能特点 (开发中)

*   **仪表盘**：概览核心数据、主要网络 Gas 等。
*   **钱包管理 (功能已完善)**：
    *   使用本地 SQLite 数据库统一管理钱包（地址、私钥、助记词、备注、分组）。
    *   **数据加密 (新!)**: 钱包的私钥和助记词在存入数据库前，会使用基于用户主密码派生的密钥进行 AES-GCM 加密存储，增强本地数据安全性。
    *   **基础操作**: 支持添加、编辑（仅备注和分组）、删除钱包。
    *   **分组管理**: 支持创建、重命名、删除钱包分组。
    *   **批量操作**: 支持批量生成钱包、批量删除钱包（带确认提示）。
    *   **导入/导出**: 支持从 JSON 文件导入钱包数据；支持将选中钱包导出为 JSON 文件（包含私钥/助记词，有安全警告）。
    *   **查看详情**: 可在模态框中查看钱包的完整地址、私钥和助记词（如果已存储），并提供复制按钮。
    *   **界面交互**: 实现表格筛选（按分组）、搜索（地址/名称/备注/分组）、分页（可自定义每页条数）、行内点击选中、统一 Toast 提示等交互优化。
        *   优化模态框样式（如钱包编辑、分组管理），统一输入框风格。
*   **社交账户管理 (基础功能已实现)**：
    *   使用本地 SQLite 数据库管理社交账户（平台、用户名、绑定邮箱/手机、备注、分组）。
    *   **基础操作**: 支持添加、编辑、删除社交账户。
    *   **界面交互**: 实现平台按钮筛选、分页（可自定义每页条数）、表头全选、行内点击选中、添加时自动选择默认分组。
        *   优化添加/编辑模态框的样式，修复分组选择布局问题。
    *   *(待实现)* 导入/导出、批量操作。
*   **项目跟踪**：卡片式展示和管理不同链上的空投项目及相关活动。
*   **脚本插件**：通过可配置的插件执行批量或自动化操作（如跨链、Swap）。
*   **IP代理管理**：管理网络代理配置。
*   **教程中心**：提供Web3知识、安全防范和项目交互教程。
*   **社区交流**：提供社区入口（如 Discord、Telegram）。
*   **软件设置**：配置应用参数。
*   **安全机制 (新!)**:
    *   **主密码**: 应用首次启动时，会引导用户设置一个主密码。
    *   **配置存储**: 加密所需的盐值 (Salt) 和 PBKDF2 迭代次数存储在用户数据目录下的 `encryption.config.json` 文件中。
    *   **加密核心**: 使用 PBKDF2 从主密码派生加密密钥，并使用 AES-GCM 对敏感数据（如钱包私钥、助记词）进行加密。
    *   *(待实现)* 应用启动解锁流程。

## 技术栈

*   **框架**: Electron
*   **前端**: HTML5, CSS3, JavaScript (ES Modules)
*   **本地数据库**: SQLite (通过 `sqlite3` Node.js 模块)
*   **核心库**: Font Awesome (图标)
*   **(未来)** 区块链交互：可能使用 ethers.js / viem 等库

## 项目结构

```
.                                   # 项目根目录
├── .gitignore                      # Git 忽略文件配置
├── README.md                       # 项目说明文档
├── database.db                     # SQLite 数据库文件（本地自动生成）
├── index.html                      # 主 HTML 骨架文件
├── main.js                         # Electron 主进程入口
├── package-lock.json               # npm 依赖锁定文件
├── package.json                    # 项目依赖与配置
├── preload.js                      # Electron Preload 脚本（用于IPC桥接）
├── src/                            # 源码目录
│   ├── css/                        # 样式文件目录
│   │   ├── main.css                # 主样式入口
│   │   ├── base/                   # 基础布局/重置/响应式样式
│   │   ├── components/             # 组件级样式（表单、模态框、按钮等）
│   │   └── pages/                  # 各页面专属样式
│   ├── js/                         # 前端 JS 逻辑
│   │   ├── core/                   # 应用核心逻辑（导航、入口、钱包生成等）
│   │   ├── components/             # 可复用UI组件逻辑
│   │   ├── db/                     # 数据库访问与CRUD（主进程用）
│   │   ├── pages/                  # 各页面业务逻辑
│   │   │   ├── dashboard/          # 仪表盘页面模块
│   │   │   │   ├── index.js        # 仪表盘页面入口
│   │   │   │   ├── actions.js      # (可选) 仪表盘操作逻辑
│   │   │   │   ├── modals.js       # (可选) 仪表盘模态框逻辑
│   │   │   │   └── table.js        # (可选) 仪表盘表格/列表逻辑
│   │   │   ├── wallets/            # 钱包管理页面模块
│   │   │   │   ├── index.js        # 钱包页面入口
│   │   │   │   ├── actions.js      # 钱包页面操作逻辑 (导入/导出/批量删除等)
│   │   │   │   ├── modals.js       # 钱包页面模态框逻辑 (编辑/分组/生成等)
│   │   │   │   └── table.js        # 钱包表格渲染/分页/筛选逻辑
│   │   │   ├── social/             # 社交账户页面模块
│   │   │   │   ├── index.js        # 社交页面入口
│   │   │   │   ├── actions.js      # 社交页面操作逻辑 (编辑/删除/批量)
│   │   │   │   ├── modals.js       # 社交页面模态框逻辑 (添加/编辑)
│   │   │   │   └── table.js        # 社交表格渲染/分页/筛选逻辑
│   │   │   ├── network/            # 网络工具页面模块 (结构同上)
│   │   │   ├── settings/           # 设置页面模块 (结构同上)
│   │   │   ├── tutorials/          # 教程页面模块 (结构同上)
│   │   │   ├── projects/           # 项目跟踪页面模块 (结构同上)
│   │   │   └── scriptPlugins/      # 脚本插件页面模块 (结构同上)
│   │   └── utils/                  # 通用工具函数
│   ├── main/                       # 主进程相关代码
│   │   └── ipcHandlers/            # 主进程IPC处理器
│   └── templates/                  # HTML页面模板片段
│       ├── dashboard.html          # 仪表盘页面模板
│       ├── wallets.html            # 钱包管理页面模板
│       ├── social.html             # 社交账户页面模板
│       ├── tool-network.html       # 网络工具页面模板
│       ├── settings.html           # 设置页面模板
│       ├── tools.html              # 工具链接页面模板
│       ├── tutorials.html          # 教程中心页面模板
│       ├── projects.html           # 项目跟踪页面模板
│       ├── script-plugins.html     # 脚本插件页面模板
│       └── community.html          # 社区交流页面模板
```

## 模块化页面结构 (vX.X - 新)

为了提高代码的可读性和可维护性，`src/js/pages/` 目录下的每个页面逻辑被拆分为独立的模块。每个页面（如 `wallets`, `social`）现在包含以下文件结构：

*   `index.js`: 页面的主入口文件。负责初始化页面，缓存必要的 DOM 元素，并协调其他模块（`actions`, `modals`, `table`）的工作。
*   `actions.js`: 处理页面级别的操作，例如头部按钮（导入、导出、批量删除）的逻辑，以及表格行内按钮（编辑、删除）的具体动作实现。
*   `modals.js`: 管理该页面所需的所有模态框（Dialogs）的逻辑，包括打开、关闭、表单处理、数据填充和与主进程的交互。
*   `table.js`: 负责页面主要数据列表（通常是表格或卡片列表）的渲染、分页、筛选和搜索逻辑。它处理数据的获取（通过 IPC）和展示。

**这种模块化结构的好处：**

*   **关注点分离 (Separation of Concerns)**：每个文件只负责一部分特定功能，使得代码更容易理解和定位。
*   **可维护性**: 修改或添加特定功能（如一个新的模态框或表格筛选）时，只需关注对应的模块文件，减少了对其他部分的影响。
*   **可读性**: 文件体积更小，逻辑更集中，提高了代码的可读性。
*   **可测试性**: （未来）更容易对独立的模块进行单元测试。

## 如何运行 (开发模式)

1.  **确保你的电脑安装了 Node.js (自带 npm)。**
2.  **克隆或下载本仓库代码。**
3.  **打开终端 (命令行)，`cd` 进入项目的根目录** (包含 `package.json` 的目录)。
4.  **安装依赖:**
    ```bash
    npm install
    ```
5.  **启动应用 (开发模式):**
    ```bash
    npm run dev
    ```
    或者
    ```bash
    npm start
    ```
    这将启动 Electron 应用，并自动打开开发者工具。

## 注意事项

*   本项目目前集成了 SQLite 本地数据库用于**钱包管理**和**社交账户管理**。其他模块的数据存储和功能仍在开发中。
*   **安全提示**: 应用已实现基于主密码的 AES-GCM 加密来保护存储的钱包私钥和助记词。请务必 **牢记并妥善保管你的主密码**，一旦丢失将无法解密数据。请勿在不安全的计算机上使用本应用。
*   链上交互功能（如查询余额、发送交易）尚未实现，表格中的相关数据为占位符。
*   导入/导出功能目前仅支持特定 JSON 格式，且导出的数据目前未加密（后续需考虑）。
*   使用任何Web3工具时都应注意安全风险。

## 后续开发计划

*   [ ] **社交账户管理**: 实现导入/导出、批量操作。
*   [ ] 完善其他模块 (项目跟踪、脚本插件等) 的 UI 和数据存储。
*   [x] 完善钱包管理模块功能（分组、导入/导出、批量操作、查看详情、UI 交互优化）。
*   [x] **社交账户管理**: 实现分组筛选、搜索功能，优化添加/编辑模态框样式及布局。
*   [x] 修复分组管理和社交账户模态框的样式问题。
*   [x] **实现安全的私钥/助记词加密存储机制 (AES-GCM + 主密码)。**
*   [ ] **实现应用启动时的解锁流程。**
*   [ ] **实现数据显示/使用时的解密逻辑。**
*   [ ] **考虑加密导出/导入功能。**
*   [ ] 集成钱包连接库 (如 Web3Modal) 或实现基础的链上数据查询 (余额, Tx数)。
*   [ ] 优化 UI 和用户体验 (持续进行)。
*   [ ] 增加单元测试和集成测试。
*   [ ] 配置 `electron-builder` 实现应用打包。

## 贡献

欢迎通过 Issue 或 Pull Request 提供建议和改进。

## 免责声明

本工具仅供学习和研究使用，用户应自行承担使用过程中的风险。开发者不对因使用本工具导致的任何损失负责。

## 近期重要更新

### 1. 数据库模块结构重构
- 数据库相关代码已模块化拆分，原本所有CRUD操作全部集中在 `src/js/db/index.js`，现已按功能分为：
  - `src/js/db/group.js`（分组相关）
  - `src/js/db/wallet.js`（钱包相关）
  - `src/js/db/social.js`（社交账户相关）
- `index.js` 只负责数据库连接、表初始化和统一导出，所有CRUD方法需传递 `db.db` 作为第一个参数。
- 这样结构更清晰，便于后续扩展教程、脚本、项目等新模块。

### 2. 主进程数据库调用方式变更
- 主进程所有数据库方法调用统一为：
  ```js
  db.addGroup(db.db, name)
  db.getWallets(db.db, options)
  db.addWallet(db.db, walletData)
  // ... 其他同理
  ```
- preload.js 和前端页面的调用方式不变，依然通过 `window.dbAPI.xxx`。

### 3. 批量生成钱包功能修复
- 修复了批量生成钱包时保存到数据库报错的问题。
- 现在批量生成的钱包会正确传递参数保存，生成失败的钱包（如为 null）会被自动过滤，不再导致数据库报错。
- 相关代码已在 `src/main/ipcHandlers/appHandlers.js` 中修正。

### 4. 其他
- 删除了未实现的占位页面（如 tool-gas、tool-bridge）及相关模板。
- navigation.js 注释精简，结构更清晰。 

### 5. Preload 脚本位置调整
- 将实际使用的 `preload.js` 文件从项目根目录移动到了 `src/` 目录下，以保持源代码结构的统一性。
- `main.js` 中加载 preload 脚本的路径 (`webPreferences.preload`) 已同步更新为 `path.join(__dirname, 'src', 'preload.js')`。
- 原根目录下多余的 `preload.js` 文件已被删除。 